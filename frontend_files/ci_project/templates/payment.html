{% extends 'base.html' %}
{% load static %}
{% block content %}



<section class="section-content padding-y bg">
    <br>
    <h1> <strong> Review Your Order and Make Payment </strong></h1>
    <div class="container">
        <div class="row">
            <div class="col-lg-9">
                    <div class="card">
                        <h5 class="card-header">Billing Address</h5>
                        <div class="card-body">
                            <p class="card-text">{{order.first_name}} {{order.last_name}}</p>
                          <p class="card-text">{{order.address}}</p>
                          <p class="card-text">{{order.city}}, {{order.state}}, {{order.country}}</p>
                          <p class="card-text">{{order.email}}</p>
                          <p class="card-text"></p>
                        </div>
                      </div>
                


                
                    <div class="card">
                        <h5 class="card-header">Payment Method</h5>
                        <div class="card-body">
                          <p class="card-text">Paypal</p>
                          
                        </div>
                      </div>
                


                
                    <div class="card">
                        <h5 class="card-header">Review Products</h5>
                        <div class="card-body">
                            {% for item_in_cart in cart_items %}
                            <div class="cart-row">
                                <div class="item"><img class="placeholder" src="{% static 'images/placeholder.jpg' %}"
                                        alt="placeholder"></div>
                                <div class="item">{{item_in_cart.product.product_id}}</div>
                                <div class="item">${{item_in_cart.product.price}}</div>
                                <div class="item">{{item_in_cart.quantity}}</div>
                                <hr>
                            </div>
                            {% endfor %}
                        </div>
                      </div>
                
            </div>    

            <div class="col-lg-3">   
                <div class="card">
                    <div class="card-body">
                        <dl class="dlist-align">
                            <dt>Total price:</dt>
                            <dd class="text-right"> ${{total}}</dd>
                        </dl>
                        <dl class="dlist-align">
                            <dt>Tax:</dt>
                            <dd class="text-right"> ${{tax}}</dd>
                        </dl>
                        <dl class="dlist-align">
                            <dt>Grand Total:</dt>
                            <input type="hidden" id="myVar" name="variable" value="{{grand_total}}">
                            <dd class="text-right text-dark b"><strong> ${{grand_total}}</strong></dd>
                        </dl>
                        <hr>
                        <p class="text-center mb-3">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-paypal" viewBox="0 0 16 16">
                                <path d="M14.06 3.713c.12-1.071-.093-1.832-.702-2.526C12.628.356 11.312 0 9.626 0H4.734a.7.7 0 0 0-.691.59L2.005 13.509a.42.42 0 0 0 .415.486h2.756l-.202 1.28a.628.628 0 0 0 .62.726H8.14c.429 0 .793-.31.862-.731l.025-.13.48-3.043.03-.164.001-.007a.351.351 0 0 1 .348-.297h.38c1.266 0 2.425-.256 3.345-.91.379-.27.712-.603.993-1.005a4.942 4.942 0 0 0 .88-2.195c.242-1.246.13-2.356-.57-3.154a2.687 2.687 0 0 0-.76-.59l-.094-.061ZM6.543 8.82a.695.695 0 0 1 .321-.079H8.3c2.82 0 5.027-1.144 5.672-4.456l.003-.016c.217.124.4.27.548.438.546.623.679 1.535.45 2.71-.272 1.397-.866 2.307-1.663 2.874-.802.57-1.842.815-3.043.815h-.38a.873.873 0 0 0-.863.734l-.03.164-.48 3.043-.024.13-.001.004a.352.352 0 0 1-.348.296H5.595a.106.106 0 0 1-.105-.123l.208-1.32.845-5.214Z"/>
                              </svg>
                        </p>
                        <div id="paypal-button-container">
                            <!-- Load paypal button-->

                        </div>

                    </div> <!-- card-body.// -->
                </div> <!-- card.// -->
            </div> 
        </div> <!-- row.// -->

    </div> <!-- container .//  -->
</section>

<!-- Script from paypal-->
<script>
    var amount = document.getElementById("myVar").value;
    
    console.log(amount);
    // Render the PayPal button into #paypal-button-container
    paypal.Buttons({

        // Set up the transaction
        createOrder: function(data, actions) {
            return actions.order.create({
                purchase_units: [{
                    amount: {
                        value: Math.round(amount*100)/100
                    }
                }]
            });
        },

        // Finalize the transaction
        onApprove: function(data, actions) {
            return actions.order.capture().then(function(orderData) {
                // Successful capture! For demo purposes:
                console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));
                var transaction = orderData.purchase_units[0].payments.captures[0];
                alert('Transaction '+ transaction.status + ': ' + transaction.id + '\n\nSee console for all available details');

                // Replace the above to show a success message within this page, e.g.
                // const element = document.getElementById('paypal-button-container');
                // element.innerHTML = '';
                // element.innerHTML = '<h3>Thank you for your payment!</h3>';
                // Or go to another URL:  actions.redirect('thank_you.html');
            });
        }


    }).render('#paypal-button-container');
</script>
{% endblock %}